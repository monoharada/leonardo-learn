# ビュー別コンピタンス/ケーパビリティ レポート（leonardo-learn）

対象: `src/ui/demo` を中心としたデモアプリ（`index.html` のナビゲーションで切り替える4画面）

このレポートでは、各ビュー（画面）について **「何を担当する画面か（コンピタンス＝責務）」** と **「その画面で何ができるか（ケーパビリティ＝機能）」** を、利用者視点で整理します。

---

## 1. 全体像（ビューの関係）

このアプリは「ブランドカラー（プライマリ）」を起点に、デザインシステム向けの色を生成・確認・検証するツールです。

- **起点は「生成（ハーモニー）」ビュー**：ここで色と条件（背景色/色数/ハーモニー）を決めます。
- 以降のビュー（パレット/シェード/アクセシビリティ）は、基本的に **生成済みの状態（`state.palettes` など）を読み取って表示**します。
- 背景色は複数ビューで共通利用され、`localStorage` に保存されます（ライト/ダーク）。

ナビゲーション（画面切替）は `src/ui/demo/navigation.ts`、ビューのルーティングは `src/ui/demo/index.ts` が担います。

---

## 2. ビュー一覧（早見表）

| 画面（UI表示） | 実装（主） | コンピタンス（責務） | ケーパビリティ（主なできること） |
|---|---|---|---|
| 生成（ハーモニー） | `src/ui/demo/views/harmony-view.ts` | 入力色と条件をもとに「候補パレット」を作り、他ビューが参照する状態を整える | 背景色/プライマリ色/色数の設定、ハーモニー選択、プレビュー、色詳細表示 |
| パレット | `src/ui/demo/views/palette-view.ts` | 生成された色を「UIの見え方」「トークン一覧」として整理して提示 | 擬似ページのプレビュー、トークン表（Primary/Secondary/Tertiary/Accent + セマンティック）、背景色調整 |
| シェード | `src/ui/demo/views/shades-view.ts` | DADSの全色相スケールを一覧し、役割オーバーレイ/境界/詳細確認を提供 | 全シェード閲覧、CVD表示、コントラスト境界表示、色詳細モーダル |
| アクセシビリティ | `src/ui/demo/views/accessibility-view.ts` | 色覚多様性（CVD）を前提に「混同しやすい色の組み合わせ」を検出・可視化 | 色覚タイプ別の見え方、混同リスク一覧、並べ替え＋隣接境界検証 |

---

## 3. 各ビューの詳細

### 3.1 生成（ハーモニー）ビュー

**対象UI**: ヘッダーの「生成」ボタンで表示される画面（DOM上は `#harmony-view`）

**実装**: `src/ui/demo/views/harmony-view.ts`

#### コンピタンス（責務）
- **入力（ブランドカラー）と条件（背景色/色数）を受け取り、パレット候補を生成して共有状態に反映する**
- ハーモニータイプを切り替えながら **「今の選択でどんな配色になるか」** を素早く確認できるようにする
- 色の詳細（DADSスケール/HEXなど）に素早くアクセスできるようにする

#### ケーパビリティ（できること）
- **背景色の設定**
  - テキスト入力またはカラーピッカーで背景色を変更（HEXまたはOKLCH入力を許容）
  - 背景色は保存され、他ビューでも同じ値を使用
- **プライマリ（ブランド）カラーの設定**
  - テキスト入力またはカラーピッカーで変更
  - 背景色とのコントラストが推奨値に満たない場合は警告表示
- **ランダム選択**
  - DADSカラーからランダムに選ぶ（背景色とのコントラストを考慮）
- **履歴**
  - 過去のプライマリ色（＋色数）を選択して復元、履歴のクリア
- **パレット色数の選択**
  - 4〜6色相当（`Primary + Secondary + Tertiary + Accent(1〜3)`）
- **ハーモニーの選択とプレビュー**
  - 複数のハーモニータイプ候補を切り替えて、現在の構成をプレビュー
  - 切り替えた結果は `state.palettes` として他ビューが参照できる状態に同期される
- **色詳細モーダル**
  - プレビュー内の各色をクリックすると、DADSスケール（可能な場合）を含む詳細モーダルを表示

#### 生成した結果（他ビューへの影響）
- `state.palettes`（Primary/Secondary/Tertiary/Accent群）を更新し、パレット/シェード/アクセシビリティ画面の表示内容の土台になります。
- `state.lightBackgroundColor` を更新し、コントラスト計算や境界表示の前提になります。

---

### 3.2 パレットビュー

**対象UI**: ヘッダーの「パレット」ボタンで表示

**実装**: `src/ui/demo/views/palette-view.ts`（内部で `palette-preview.ts`, `palette-token-table.ts` を使用）

#### コンピタンス（責務）
- 生成された色を「デザインシステムのトークン」として見える形に整理し、**“実際の画面でどう見えるか”** を素早く確認できるようにする
- Primary/Secondary/Tertiary/Accentだけでなく、リンクやSuccess/Warning/Errorなどの **セマンティックカラーの当て方** を提示する

#### ケーパビリティ（できること）
- **背景色（ライト/ダーク）の変更**
  - 背景色を変更して、プレビューや各種計算の前提を調整できる（保存される）
- **カラープレビュー（擬似ページ）**
  - 生成色を、ヘッダー/CTA/カード/フォームなどの擬似UIに当てた状態で確認できる
  - 読みにくくなる場合は、内部でテキスト色を自動調整して破綻しにくくしている
- **トークン一覧（テーブル表示）**
  - Primary/Secondary/Tertiary/Accent（生成した色）＋セマンティック（Link/Success/Warning/Error）を、トークン名・プリミティブ名・HEXで一覧できる
  - Linkのスタイルは、Primaryの色相/明度から自動選択される

#### 注意点（現状の振る舞い）
- パレットビューは **「表示・確認」に特化**しており、色クリックで詳細モーダルを開く動線は（現状の実装では）ありません。

---

### 3.3 シェードビュー

**対象UI**: ヘッダーの「シェード」ボタンで表示

**実装**: `src/ui/demo/views/shades-view.ts`

#### コンピタンス（責務）
- DADS（デジタル庁デザインシステム）に基づく **全色相のシェードスケール** を一覧し、検討・比較・説明に使える「カラーカタログ」を提供する
- 生成した配色が DADS スケール上でどこに位置づくか、どんな役割に割り当たっているかを **オーバーレイ（ラベル）で可視化**する
- 背景色（ライト/ダーク）に対して「どのステップから読める/読みにくいか」を **境界として提示**する

#### ケーパビリティ（できること）
- **背景色（ライト/ダーク）の変更**
  - 背景色を変えて、境界表示やコントラストの前提を調整できる（保存される）
- **全DADSシェードの閲覧**
  - 色相ごとに 50〜1200 のスケールを一覧表示（スウォッチにスケール値とHEXを表示）
- **CVD（色覚）シミュレーション表示**
  - ヘッダーの色覚切替（通常/P型/D型/T型/全色盲）に応じて、表示色をシミュレーションして見え方を確認できる
- **セマンティックロールのオーバーレイ**
  - Primary等の役割が割り当てられている色を、ラベルや装飾（円形化など）で強調表示する
- **コントラスト境界（ピル表示）**
  - その色相スケールの中で、背景に対するコントラスト要件の「境目」を視覚的に示す
- **色詳細モーダル**
  - 任意のスウォッチをクリックすると、その色相スケールを含む詳細モーダルを開き、段階比較ができる

---

### 3.4 アクセシビリティビュー

**対象UI**: ヘッダーの「アクセシビリティ」ボタンで表示

**実装**: `src/ui/demo/views/accessibility-view.ts`

#### コンピタンス（責務）
- 多様な色覚特性を前提に、**「区別がつきにくい色の組み合わせ」** を検出・説明する
- 単に見え方を並べるだけではなく、並べ替え（ソート）を使って **隣接境界（隣同士の差）** を検証し、リスク箇所を特定しやすくする

#### ケーパビリティ（できること）
- **この機能について（説明）**
  - 何を判定しているか、どんなアルゴリズム/閾値を使っているかを画面内で説明
- **CVD混同リスクの検出**
  - P型/D型/T型/全色盲の各条件で、混同しやすい色ペアを検出し、色見本＋ΔEで提示
- **並べ替えタブ**
  - 色相順・色差順・明度順など、複数基準で並べ替えて「隣接する色の境界」が危険かどうかを検証
- **隣接境界の可視化**
  - 問題のある境界にマーカー（警告）を出し、ΔEも合わせて表示する

#### 注意点（現状の振る舞い）
- このビューは画面内で色覚タイプ別の表示をまとめて行うため、ヘッダーのCVD切替UIは非表示になります（ナビゲーション側で制御）。

---

## 4. ビュー横断の共通要素（参考）

「ビュー」そのものではありませんが、理解の助けになるため補足します。

- **ナビゲーション（画面切替）**: `src/ui/demo/navigation.ts`
  - 4画面の表示切替、ライブリージョンによるスクリーンリーダー通知、CVDコントロールの表示/非表示を担当
- **CVDコントロール（ヘッダー）**: `src/ui/demo/cvd-controls.ts`
  - `state.cvdSimulation` を更新し、主にシェードビュー側でシミュレーション表示に反映
- **色詳細モーダル**: `src/ui/demo/color-detail-modal.ts`
  - Harmony/シェードでクリックされた色の「スケール」「コントラスト」など詳細確認を提供
- **背景色の保存**: `src/ui/demo/state.ts`
  - 背景色（ライト/ダーク）を検証し、`localStorage` に保存して画面間で同期
