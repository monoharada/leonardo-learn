# Phase 1: 数値的検証 - 分析レポート

## 実行日時
2026-01-22

## 調査概要

DADSトークンからパステル条件（L≥0.75, C≤0.1）を満たす色を抽出し、白背景（#ffffff）に対するコントラスト比を数値的に検証しました。

---

## 主要な発見

### 1. パステル色の抽出結果

| 項目 | 値 |
|------|-----|
| 総DADSトークン数 | 164 |
| 有彩色トークン数 | 130 |
| パステル条件を満たすトークン数 | 29 |
| パステル比率 | 22.3% |

### 2. 白背景に対するコントラスト比統計

| 指標 | 値 |
|------|-----|
| **最小値** | **1.066:1** |
| **最大値** | **1.986:1** |
| **平均値** | **1.314:1** |
| 中央値 | 1.261:1 |
| 標準偏差 | 0.221 |

### 3. WCAG基準達成率（白背景）

| 基準 | 達成数 | 達成率 |
|------|--------|--------|
| WCAG AA Large Text (3:1) | 0/29 | **0.0%** |
| WCAG AA Normal Text (4.5:1) | 0/29 | **0.0%** |
| WCAG AAA Large Text (4.5:1) | 0/29 | **0.0%** |
| WCAG AAA Normal Text (7:1) | 0/29 | **0.0%** |

### 4. コントラスト比分布（白背景）

| 範囲 | 色数 | 割合 |
|------|------|------|
| < 1.5:1 (非常に低い) | 22 | 75.9% |
| 1.5:1 - 2:1 (低い) | 7 | 24.1% |
| 2:1 - 3:1 (やや低い) | 0 | 0.0% |
| 3:1以上 | 0 | 0.0% |

---

## 重要な結論

### パステル色と白背景の組み合わせは数学的に不可能

**パステル条件（L≥0.75, C≤0.1）を満たす色は、白背景で3:1コントラストを達成することが原理的に不可能です。**

理由：
- パステル色のOKLCH明度(L)は0.75以上
- 白背景のOKLCH明度(L)は約0.999
- 明度差が小さすぎるため、どうしてもコントラスト比が低くなる
- **最大コントラスト比でも1.986:1**であり、3:1に遠く及ばない

### 暗い背景では全く問題なし

| 基準 | 暗い背景(#1a1a2e)での達成率 |
|------|---------------------------|
| WCAG AA Large Text (3:1) | **100.0%** |
| WCAG AA Normal Text (4.5:1) | **100.0%** |
| WCAG AAA Large Text (4.5:1) | **100.0%** |
| WCAG AAA Normal Text (7:1) | **100.0%** |

暗い背景では全パステル色が最も厳しいWCAG AAA基準（7:1）も満たしています。

---

## フォールバック・ロジックの問題

`studio-view.ts` 308-311行目のフォールバック・ロジック：

```typescript
const contrastFiltered = baseList.filter((t) => {
  const ratio = wcagContrast(backgroundHex, t.hex);
  return ratio >= minContrast;  // 3:1
});
const finalList = contrastFiltered.length > 0 ? contrastFiltered : baseList;
```

**問題点：**
- パステル色で3:1を満たす色が**存在しない**
- `contrastFiltered.length`は常に0になる
- フォールバックとして全パステル色を使用（コントラスト条件を完全に無視）

これは**バグではなく、設計上の限界**です。パステル色と白背景の組み合わせでは、どの色を選んでも基準を満たせません。

---

## 推奨対策

### 対策A: 背景色の自動調整（推奨度: ★★★★★）

パステルプリセット選択時に、背景色を暗めに自動調整する。

**メリット：**
- 全パステル色で即座に7:1以上のコントラストを達成可能
- パステルの「柔らかさ」を完全に維持
- 実装が比較的シンプル

**実装案：**
```typescript
if (preset === "pastel") {
  backgroundHex = "#1a1a2e"; // または適切な暗い色
}
```

### 対策B: 明度制約の緩和（推奨度: ★★★☆☆）

L ≥ 0.75 → L ≥ 0.55 など、パステルの定義を調整。

**メリット：**
- 白背景でも使用可能になる

**デメリット：**
- 「パステル」の定義から外れる可能性
- より暗い色が混入し、パステルらしさが失われる

### 対策C: ユーザーへのガイダンス（推奨度: ★★☆☆☆）

パステルプリセット選択時に「暗い背景を推奨」の警告を表示。

**メリット：**
- ユーザーに選択権を与える

**デメリット：**
- UX上の摩擦が増加
- 問題の根本解決にならない

### 対策D: フォールバック時の明度自動調整（推奨度: ★★★☆☆）

コントラスト不足時に、パステル色の明度を自動的に下げる。

**メリット：**
- 必要な場合のみ調整が入る

**デメリット：**
- 調整後の色が「パステル」ではなくなる
- DADSトークンの改変になり、設計思想に反する可能性

---

## Phase 2への推奨事項

Phase 2（視覚的検証）では、以下を確認することを推奨：

1. **実際のStudioプレビューでのパステル色の見え方**
2. **Headline, Button, Card等の各要素での視認性**
3. **暗い背景に変更した場合の視覚的な印象**
4. **他プリセット（Vibrant, Dark等）との比較**

---

## 添付ファイル

- `scripts/analyze-pastel-contrast.ts` - 本分析に使用したスクリプト
