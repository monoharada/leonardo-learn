# ハーモニー選択UX再設計

## 概要

本ドキュメントは、カラーパレット生成ツールのハーモニー選択UIを人間中心設計に基づいて再設計するための設計書である。

---

## 1. 現状の問題点

### 現在のフロー
```
色コード入力 → Generateボタンクリック → ハーモニー選択
```

### 問題点

| 問題 | 詳細 |
|------|------|
| 冗長なステップ | Generateボタンが不要な中間ステップ |
| 不自然な順序 | ハーモニーを先に選びたい場合に対応できない |
| 即時フィードバック不在 | 入力しても視覚的な変化がない |
| 視覚的選択不可 | 色をテキストでしか入力できない |
| 比較検討困難 | 各ハーモニーの結果を事前にプレビューできない |

---

## 2. 設計原則

### 人間中心設計の観点

1. **明示的な操作**: 即時フィードバックではなく、意図的な選択アクションで確定
2. **比較検討可能**: 選択前に全パターンをプレビューで確認できる
3. **いつでも戻れる**: 起点（ハーモニー選択）への明確な導線
4. **アクセシビリティ**: キーボード操作、スクリーンリーダー対応

### WCAG 2.2 準拠ポイント

- タイミング調整可能（即時フィードバックを避ける）
- 明確なフォーカス管理
- 操作の取り消し可能性

---

## 3. 情報アーキテクチャ

### 階層構造

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  レベル0（起点）      レベル1（詳細ビュー）                 │
│       │                    │                                │
│   Harmony ─────┬───── パレット                              │
│                ├───── シェード                              │
│                └───── アクセシビリティ                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### ナビゲーション構造

```
┌────────────────────────────────────────────────────────────────┐
│                                                                │
│   ┌──────────┐   ┌─────────────────────────────────────────┐  │
│   │ Harmony  │   │ パレット │ シェード │ アクセシビリティ │  │
│   └──────────┘   └─────────────────────────────────────────┘  │
│        ↑                           ↑                          │
│     独立ボタン              セグメントコントロール            │
│   （起点に戻る）            （詳細ビュー切替）                │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 4. 状態遷移

### 状態定義

| 状態 | 説明 | 表示内容 |
|------|------|----------|
| Harmony選択 | 起点状態 | 色入力 + ハーモニーカード一覧 |
| パレットビュー | 詳細ビュー | パレット一覧表示 |
| シェードビュー | 詳細ビュー | シェード表示 |
| アクセシビリティビュー | 詳細ビュー | コントラスト・CVD情報 |

### 遷移図

```
                        ┌──────────────────┐
         アプリ起動 ──▶│ Harmony選択      │◀─────────────┐
                        └────────┬─────────┘              │
                                 │                        │
                        カード選択（確定）          Harmonyボタン
                                 │                        │
                                 ▼                        │
                ┌────────────────────────────────┐        │
                │ 詳細ビュー                      │────────┘
                │ ┌────────┬────────┬──────────┐ │
                │ │パレット│シェード│アクセシビ│ │
                │ │        │        │リティ    │ │
                │ └────────┴────────┴──────────┘ │
                └────────────────────────────────┘
                         ↑        ↑        ↑
                         └────────┴────────┘
                      セグメントコントロールで切替
```

---

## 5. 画面設計

### 5.1 Harmony選択画面（状態1）

```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー                                                        │
│ ┌──────────┐   ┌─────────────────────────────────────────┐     │
│ │ Harmony  │   │ パレット │ シェード │ アクセシビリティ │     │
│ │ (active) │   │ (disabled until harmony selected)       │     │
│ └──────────┘   └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  サイドバー                    │  メインコンテンツ              │
│  ┌─────────────────────────┐  │  ┌─────────────────────────┐   │
│  │ Brand Color             │  │  │                         │   │
│  │ ┌────┬───────────────┐  │  │  │  ハーモニースタイルを    │   │
│  │ │ 🎨 │ #0066CC       │  │  │  │  選択してください        │   │
│  │ └────┴───────────────┘  │  │  │                         │   │
│  │                         │  │  │  各スタイルの特徴：      │   │
│  │                         │  │  │  ・補色：対照的な印象    │   │
│  │                         │  │  │  ・類似色：調和的な印象  │   │
│  │                         │  │  │  ・三角配色：バランス    │   │
│  │                         │  │  │                         │   │
│  └─────────────────────────┘  │  └─────────────────────────┘   │
│                               │                                 │
│  ハーモニーカード              │                                 │
│  ┌─────────────────────────┐  │                                 │
│  │ ┌─────────┐┌─────────┐  │  │                                 │
│  │ │ Comp    ││ Analog  │  │  │                                 │
│  │ │ ██  ██ ││ ██████  │  │  │                                 │
│  │ │ 補色    ││ 類似色  │  │  │                                 │
│  │ └─────────┘└─────────┘  │  │                                 │
│  │ ┌─────────┐┌─────────┐  │  │                                 │
│  │ │ Triad   ││ Split   │  │  │                                 │
│  │ │ ██████  ││ ██████  │  │  │                                 │
│  │ │三角配色 ││分裂補色 │  │  │                                 │
│  │ └─────────┘└─────────┘  │  │                                 │
│  │ ┌─────────┐┌─────────┐  │  │                                 │
│  │ │ Tetrad  ││ Square  │  │  │                                 │
│  │ │ ████████││ ████████│  │  │                                 │
│  │ │ 四角形  ││ 正方形  │  │  │                                 │
│  │ └─────────┘└─────────┘  │  │                                 │
│  │ ┌─────────┐┌─────────┐  │  │                                 │
│  │ │ M3      ││ DADS    │  │  │                                 │
│  │ │ ████████││ ████████│  │  │                                 │
│  │ │Material ││12色相   │  │  │                                 │
│  │ └─────────┘└─────────┘  │  │                                 │
│  └─────────────────────────┘  │                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 詳細ビュー画面（状態2）

```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー                                                        │
│ ┌──────────┐   ┌─────────────────────────────────────────┐     │
│ │ Harmony  │   │ パレット │ シェード │ アクセシビリティ │     │
│ │          │   │ (active) │          │                   │     │
│ └──────────┘   └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  サイドバー                    │  メインコンテンツ              │
│  ┌─────────────────────────┐  │  ┌─────────────────────────┐   │
│  │ Complementary           │  │  │                         │   │
│  │ Base: #0066CC           │  │  │  ████████████████████   │   │
│  │                         │  │  │  ████████████████████   │   │
│  │ ─────────────────────   │  │  │  ████████████████████   │   │
│  │                         │  │  │                         │   │
│  │ Palettes                │  │  │                         │   │
│  │ ├─ Primary   ████       │  │  │                         │   │
│  │ └─ Secondary ████       │  │  │                         │   │
│  │                         │  │  │                         │   │
│  │ [+ Add Custom Palette]  │  │  │                         │   │
│  │                         │  │  │                         │   │
│  │ ─────────────────────   │  │  │                         │   │
│  │                         │  │  │                         │   │
│  │ Export                  │  │  │                         │   │
│  │ [CSS] [Tailwind] [JSON] │  │  │                         │   │
│  └─────────────────────────┘  │  └─────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. コンポーネント設計

### 6.1 ハーモニーカード

ネイティブ `<button>` を使用し、可視テキストをアクセシブルネームとして利用する。
`role="button"` や冗長な `aria-label` は不要。

```html
<button class="dads-harmony-card">
  <div class="dads-harmony-card__preview">
    <!-- ミニパレットプレビュー -->
    <span class="dads-harmony-card__swatch" style="background: #0066CC"></span>
    <span class="dads-harmony-card__swatch" style="background: #CC6600"></span>
  </div>
  <div class="dads-harmony-card__label">
    <!-- この可視テキストがアクセシブルネームになる -->
    <span class="dads-harmony-card__name">Complementary</span>
    <span class="dads-harmony-card__description">補色</span>
  </div>
</button>
```

### 6.2 ナビゲーションヘッダー

タブUIはWAI-ARIA Authoring Practices に準拠し、以下を満たす：
- 選択されたタブは `tabindex="0"`、非選択は `tabindex="-1"`
- 各タブは `aria-controls` で対応する `tabpanel` のIDを参照
- `tabpanel` は `aria-labelledby` でタブのIDを参照
- 矢印キーでタブ間を移動（roving tabindex）

```html
<header class="dads-main__header">
  <!-- 起点ボタン（独立） -->
  <button
    class="dads-nav-button"
    aria-current="page"
  >
    Harmony
  </button>

  <!-- 詳細ビュー切替（タブリスト） -->
  <div class="dads-view-switcher" role="tablist" aria-label="ビュー切替">
    <button
      id="tab-palette"
      role="tab"
      aria-selected="true"
      aria-controls="panel-palette"
      tabindex="0"
    >
      パレット
    </button>
    <button
      id="tab-shades"
      role="tab"
      aria-selected="false"
      aria-controls="panel-shades"
      tabindex="-1"
    >
      シェード
    </button>
    <button
      id="tab-a11y"
      role="tab"
      aria-selected="false"
      aria-controls="panel-a11y"
      tabindex="-1"
    >
      アクセシビリティ
    </button>
  </div>
</header>

<!-- 対応するタブパネル -->
<div
  id="panel-palette"
  role="tabpanel"
  aria-labelledby="tab-palette"
  tabindex="0"
>
  <!-- パレットビューの内容 -->
</div>

<div
  id="panel-shades"
  role="tabpanel"
  aria-labelledby="tab-shades"
  tabindex="0"
  hidden
>
  <!-- シェードビューの内容 -->
</div>

<div
  id="panel-a11y"
  role="tabpanel"
  aria-labelledby="tab-a11y"
  tabindex="0"
  hidden
>
  <!-- アクセシビリティビューの内容 -->
</div>
```

### 6.3 タブ操作のJavaScript要件

```javascript
// キーボード操作
// - ArrowLeft/ArrowRight: 前後のタブに移動（roving tabindex）
// - Home: 最初のタブに移動
// - End: 最後のタブに移動
// - Enter/Space: タブを選択（button要素なので自動）

// タブ選択時の処理
function selectTab(selectedTab) {
  // 全タブの aria-selected を false、tabindex を -1 に
  tabs.forEach(tab => {
    tab.setAttribute('aria-selected', 'false');
    tab.setAttribute('tabindex', '-1');
  });

  // 選択タブを active に
  selectedTab.setAttribute('aria-selected', 'true');
  selectedTab.setAttribute('tabindex', '0');
  selectedTab.focus();

  // 対応するパネルを表示
  const panelId = selectedTab.getAttribute('aria-controls');
  panels.forEach(panel => panel.hidden = true);
  document.getElementById(panelId).hidden = false;
}
```

---

## 7. アクセシビリティ要件

### フォーカス管理

| 遷移 | フォーカス移動先 |
|------|------------------|
| アプリ起動 | 色入力フィールド |
| カード選択 | 詳細ビューのメインコンテンツ |
| Harmonyボタン | 色入力フィールド |
| セグメント切替 | 選択したビューのコンテンツ |

### ARIA属性

| 要素 | 属性 | 備考 |
|------|------|------|
| ハーモニーカード | なし（ネイティブbutton） | 可視テキストがアクセシブルネーム |
| タブリスト | `role="tablist"`, `aria-label` | コンテナに付与 |
| タブ | `role="tab"`, `aria-selected`, `aria-controls`, `tabindex` | roving tabindex使用 |
| タブパネル | `role="tabpanel"`, `aria-labelledby`, `tabindex="0"` | 非選択時は `hidden` |
| Harmonyボタン | `aria-current="page"` | 選択時のみ |
| 状態通知 | `aria-live="polite"` | 状態変化時 |

### キーボード操作

| キー | 動作 |
|------|------|
| Tab | フォーカス移動 |
| Enter/Space | カード選択、ボタン押下 |
| Arrow Keys | セグメントコントロール内移動 |
| Escape | モーダル閉じる（カラー詳細ダイアログ） |

---

## 8. 実装計画

### Phase 1: ナビゲーション構造変更
- [ ] ヘッダーにHarmonyボタン追加
- [ ] セグメントコントロールとの視覚的分離
- [ ] 状態管理の追加（currentView: 'harmony' | 'palette' | 'shades' | 'a11y'）

### Phase 2: Harmony選択UI
- [ ] ハーモニーカードコンポーネント作成
- [ ] カード内ミニプレビュー実装
- [ ] カラーピッカー統合（input type="color"）
- [ ] Generateボタン廃止

### Phase 3: 状態遷移実装
- [ ] カード選択時の詳細ビュー遷移
- [ ] Harmonyボタンでの起点復帰
- [ ] フォーカス管理実装

### Phase 4: アクセシビリティ強化
- [ ] ARIA属性追加
- [ ] キーボード操作対応
- [ ] スクリーンリーダーテスト

---

## 9. 変更履歴

| 日付 | バージョン | 変更内容 |
|------|------------|----------|
| 2025-11-25 | 1.0.0 | 初版作成 |
