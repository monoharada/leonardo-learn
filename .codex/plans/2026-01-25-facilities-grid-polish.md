# 手続き案内（カテゴリ導線）タイルグリッドの整列・リズムを改善（image-v9準拠）

Date: 2026-01-25
Source: `.context/attachments/image-v9.png`

## 目標
- 右カラムの「手続き案内」タイルグリッドを、**列・余白・ラベル行**のリズムが揃った“美しいグリッド”にする
- タイルが **カテゴリへの遷移リンク** だと一目で分かり、クリック/タップ領域も十分に確保する
- DADS準拠で `:focus-visible` が **見切れず**、かつ一貫して目立つ（フォーカス可視性最優先）
- 画面上に **横文字（英字）を出さない**

## 背景
- 現状はグリッドのトラック幅とタイル外形が一致しておらず、余白・列揃えが崩れて見える。
- ラベルの `nowrap` により、長いラベルが“収まりきらない/不自然な間延び”に見えやすい。
- practical-ui-2nd-edition の観点では、**塊（グルーピング）** と **押せる要素の一貫性** を維持しつつ、見た目のノイズ（不揃いな幅・改行）を減らすのが最優先。

## スコープ
- やること：
  - `src/ui/styles/components.css` の Facilities（手続き案内）グリッド/タイルのサイズモデルを見直し、**グリッド列幅＝タイル外形幅** を保証
  - ラベルを自然に折返せるようにしつつ、**行高さを揃えて** グリッドのベースラインを安定させる
  - 必要最小限で `src/ui/demo/views/palette-preview.ts` のラベル表示（`・` 位置など）を調整
  - `bun test` を通す（必要ならDOMテストを最小更新）
- やらないこと：
  - ルーティング/遷移先の実装
  - 依存追加
  - セクション全体レイアウト（2カラム構造）の再設計

## 前提 / 制約
- タイルは **遷移リンク**（選択UIではない）として表現を統一（AP-INT回避）
- アクセント色は「リンク/導線」の意味に寄せ、装飾や状態表現と混ぜない（AP-C2回避）
- フォーカスリングをクリップしない（親の `overflow`、密な gap、`border-radius` に注意）
- 画面に英字テキストを出さない（見出し/ラベル/補助文は日本語のみ）

## 変更内容（案）
### UI / UX
- CSS（`src/ui/styles/components.css`）
  - グリッド列を `auto-fit` + 固定トラック（例：`repeat(auto-fit, var(--preview-facility-track))`）へ寄せ、右カラム幅に応じて **4→3→2列** と自然に変化させる
  - タイル外形（リンク要素）の `inline-size` をトラック幅に合わせ、**列のセンタリングぶれ**をなくす
  - ラベルは `nowrap` を解除し、`max-inline-size` と `min-height`（2行想定）で **行高と折返し** を安定化
- Markup（`src/ui/demo/views/palette-preview.ts`）
  - 長いラベル（例：住まい・引っ越し）に `・` 直後の `<wbr>` などを入れ、**意図した位置で自然に折返す**（DOMテストの文字列は維持）

## 受入基準
- [ ] グリッドが列/行で揃い、タイルの外形がトラックからはみ出さない（“ガタつき”が無い）
- [ ] 4列（十分な横幅）→ 3列 → 2列へ自然に崩れ、主要幅で破綻しない
- [ ] ラベルが不自然に詰まらず、2行までで読みやすい（長文は自然折返し）
- [ ] `:focus-visible` が見切れず、キーボード操作で迷わない
- [ ] 画面上の見出し/ラベルが日本語のみ（横文字なし）
- [ ] `bun test` がパスする

## リスク / エッジケース
- `wbr` などでラベルが意図せず折返す可能性（→ `min-height` と `line-height` で見た目を安定）
- `auto-fit` により、右カラム幅が狭いと列数が下がり縦が伸びる（→ gap/トラック幅を調整）
- focus ring が隣接タイルと干渉して視認性が落ちる（→ `gap` / `outline-offset` を再確認）

## 作業項目（Action items）
1. Planを保存（完了条件: `.codex/plans/` に本ファイルが存在）
2. グリッドのトラック/タイル外形のサイズモデルを整理（完了条件: トラック幅＝タイル外形幅）
3. ラベル折返しと行高を安定化（完了条件: 2行想定で揃う）
4. 必要なら `<wbr>` 等で折返し制御を追加（完了条件: “住まい・引っ越し” が読みやすい）
5. テストを最小更新し `bun test` 実行（完了条件: 全テストパス）

## テスト計画
- 自動: `bun test`
- 目視: 右カラムのグリッド整列、主要幅での列数変化、Tabフォーカス、ラベル折返し

## オープンクエスチョン
- 該当なし

