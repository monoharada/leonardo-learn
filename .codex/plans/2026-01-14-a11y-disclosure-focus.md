# アクセシビリティビュー: 「この機能について」をディスクロージャー化＋エラークリックで該当箇所フォーカス

## Context
- `src/ui/demo/views/accessibility-view.ts` の冒頭「この機能について」説明（`.dads-a11y-explanation`）が常時展開で、表示領域を大きく占有している。
- 同ビュー内の CVD 混同リスク（エラー/警告）表示は内容を読めるが、「どこが問題か」を画面内で即座に特定する導線（クリック→該当箇所へフォーカス/ハイライト）がない。

## Scope
- やること：
  - 「この機能について」を開閉できるディスクロージャー（`details/summary`）に置換し、占有を減らす（DADSのディスクロージャーのUIパターンに寄せる）。
  - 比較シミュレーション（CVD混同リスク/警告）で表示される“エラー内容”をクリックすると、シミュレーション表示側の該当箇所（対象の色）へスクロール＋フォーカス＋視覚的ハイライトするUIを追加する。
- やらないこと：
  - CVD検出ロジックや閾値（ΔE等）の変更
  - アクセシビリティビュー全体の再設計（レイアウト全面刷新、コンポーネント分割の大規模化）
  - 新規依存追加（外部UIライブラリ導入など）

## Assumptions
- 「この機能について」はデフォルトで閉じる。
- “エラー内容のクリック”は、CVD 混同リスク一覧（`.dads-a11y-cvd-pair-item`）の各ペアを主対象とし、クリックで境界検証リスト側（`.dads-a11y-boundary-container`）の該当CVD行をハイライトする。
- DADSのディスクロージャーは、DADS HTMLのマークアップ/スタイル（`.dads-disclosure`）を参考にしつつ、既存のデザイントークン/フォーカス規約に合わせる。

## Risks / Edge cases
- ソート切替でDOMを再生成するため、ハイライト対象は都度DOMから再検索する必要がある。
- クリック→スクロール→ハイライトは、対象の色が現在の並びで離れている場合もあるため、「2色を強調する」表現に留める（境界そのものを示せないケースがある）。
- 生成物スクリーンショット等が「この機能について」テキストの可視を前提にしている可能性がある（summaryにテキストを残す）。

## Action items
1. 対象箇所の現状確認とUI導線の定義（完了条件: 変更対象DOM/CSSとクリック→フォーカス先をコード上で特定できている）
2. 「この機能について」をディスクロージャーに置換（`section+h2` → `details+summary+content`）（完了条件: 開閉でき、`summary` にタイトルが常時表示される）
3. ディスクロージャーの見た目をDADS準拠トーンに調整（`components.css`でsummary/開閉状態の余白・アイコン・フォーカスを整える）（完了条件: 既存UIと違和感なく、キーボード操作でも視認できる）
4. 境界検証側の行/スウォッチに安定した参照情報を付与（例: `data-cvd-type`, `data-color-name`）（完了条件: 任意のCVDタイプ行と色スウォッチをDOM検索で一意に特定できる）
5. CVD混同リスク一覧（エラー内容）をクリック可能UIに変更（`li`内を`button`化など、キーボード操作対応）（完了条件: Tab/Enter/Spaceで発火し、誤クリックしにくい見た目になる）
6. クリック時に「該当箇所へスクロール＋フォーカス＋ハイライト」を実装（ハイライト解除/多重クリックの扱いも含む）（完了条件: クリック→該当CVD行が画面中央付近に出て、対象2色が明確に強調される）
7. スタイル追加（ハイライト用クラス、ホバー/フォーカス状態、必要なら軽いアニメーション）を `components.css` に実装（完了条件: “ここ”が視覚的に即分かるが、過度に騒がしくない）
8. テスト/ドキュメント調整（既存テスト更新＋必要なら1本追加、`docs/view-capabilities-ja.md` の説明反映、デッキ生成スクリプト影響確認）（完了条件: `bun test` と既存E2Eが通り、説明資料が破綻しない）

## Test plan
- Unit: `bun test`（特に `src/ui/demo/views/accessibility-view.test.ts`）
- E2E: `bun run test:e2e -- e2e/accessibility-view-sorting.e2e.ts`
- Manual:
  - 「この機能について」が開閉でき、閉じた状態で冒頭の占有が減る
  - CVD混同リスクの各ペアをクリックすると、該当CVD行へスクロールし、対象の色がハイライトされる
  - キーボード（Tab/Enter/Space）でも同等に動作し、フォーカスが見える

## Open questions
- 初期状態（open/close）や、警告サマリー（`.dads-a11y-alert-box`）もクリック可能にするかは実装中に確認する。

