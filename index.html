<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Token Generator</title>
    <!-- Google Fonts: Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Material Symbols for icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <!-- DADS Design System Styles -->
    <link rel="stylesheet" href="./src/ui/styles/tokens.css">
    <link rel="stylesheet" href="./src/ui/styles/global.css">
    <link rel="stylesheet" href="./src/ui/styles/utilities.css">
    <link rel="stylesheet" href="./src/ui/styles/components.css">
    <link rel="stylesheet" href="./src/ui/styles/app-components.css">
</head>

<body class="is-studio-view">
    <div class="dads-layout dads-layout--full">
        <!-- Main Content -->
        <main class="dads-main">
            <!-- Header / View Switcher -->
            <header class="dads-main__header">
                <!-- タイトル -->
                <h1 class="dads-header__title">Color Token Generator</h1>

                <!-- ナビゲーション -->
                <nav class="dads-nav" aria-label="メインナビゲーション">
                    <button id="view-studio" class="dads-button" data-size="lg" data-type="text" data-active="true">スタジオ</button>
                    <button id="view-manual" class="dads-button" data-size="lg" data-type="text">マニュアル選択</button>
                </nav>

                <!-- CVD Simulation Controls -->
                <div id="cvd-controls" class="dads-cvd-controls">
                    <div class="dads-header-controls">
                        <label class="dads-header-controls__label">色覚:</label>
                        <div id="cvdTypeButtons" class="dads-button-group">
                            <button data-cvd="normal" class="dads-button" data-size="sm" data-active="true">通常</button>
                            <button data-cvd="protanopia" class="dads-button" data-size="sm">P型</button>
                            <button data-cvd="deuteranopia" class="dads-button" data-size="sm">D型</button>
                            <button data-cvd="tritanopia" class="dads-button" data-size="sm">T型</button>
                            <button data-cvd="achromatopsia" class="dads-button" data-size="sm">全色盲</button>
                        </div>
                    </div>
                    <div class="dads-header-controls">
                        <label class="dads-header-controls__label" title="要約/バッジ/アクセシビリティ表示の判定しきい値。生成スコアは固定（ΔE&lt;5.0）。">混同判定（表示）:</label>
                        <div id="cvdConfusionThresholdButtons" class="dads-button-group">
                            <button data-threshold="3.5" class="dads-button" data-size="sm" data-active="true">3.5</button>
                            <button data-threshold="5.0" class="dads-button" data-size="sm">5.0</button>
                        </div>
                    </div>
                    <div id="cvd-score" class="dads-cvd-score">
                        <span class="dads-cvd-score__label">識別性スコア:</span>
                        <span id="cvd-score-value" class="dads-cvd-score__value">-</span>
                        <span id="cvd-score-grade" class="dads-cvd-score__grade">-</span>
                        <button id="a11y-drawer-trigger" class="dads-a11y-trigger dads-button"
                                data-size="sm" data-type="text"
                                type="button"
                                aria-expanded="false"
                                aria-controls="a11y-drawer">
                            <svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 -960 960 960" width="18" fill="currentColor">
                                <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 240q33 0 56.5-23.5T560-320v-120h80v-80H320v80h80v120q0 33 23.5 56.5T480-240Zm0-320q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Z"/>
                            </svg>
                            詳細
                            <span id="a11y-issue-badge" class="dads-a11y-badge" hidden></span>
                        </button>
                    </div>
                </div>

            </header>

            <!-- Content Area -->
            <div id="main-content" class="dads-main__content">
                <!-- スタジオ/マニュアル選択ビュー -->
                <div id="app" class="palette">
                    <!-- Views will be rendered here -->
                </div>
            </div>

            <!-- 状態通知用ライブリージョン -->
            <div id="live-region" class="dads-u-visually-hidden" aria-live="polite" aria-atomic="true"></div>
        </main>
    </div>

    <!-- Hidden state storage -->
    <input type="hidden" id="harmony" value="complementary">
    <input type="hidden" id="keyColors" value="#3366cc">

    <!-- ダミー要素（demo.ts互換用） -->
    <div id="palette-list" hidden></div>

    <!-- Export Modal -->
    <dialog id="export-dialog" class="dads-dialog">
        <h3 class="dads-dialog__title">Export</h3>
        <div class="dads-dialog__body">
            <div class="dads-form-field">
                <label class="dads-label">Format</label>
                <div id="export-format-buttons" class="dads-button-group">
                    <button data-format="css" class="dads-button" data-size="sm" data-active="true">CSS</button>
                    <button data-format="tailwind" class="dads-button" data-size="sm">Tailwind</button>
                    <button data-format="json" class="dads-button" data-size="sm">JSON</button>
                </div>
            </div>
            <textarea id="export-area" class="dads-input dads-dialog__textarea" readonly></textarea>
        </div>
        <div class="dads-dialog__footer">
            <button id="export-copy-btn" class="dads-button" data-variant="primary">Copy</button>
            <button id="export-download-btn" class="dads-button">Download</button>
            <button onclick="document.getElementById('export-dialog').close()" class="dads-button">Close</button>
        </div>
    </dialog>

    <!-- Accessibility Drawer -->
    <dialog id="a11y-drawer" class="dads-dialog dads-dialog--drawer-right">
        <div class="dads-drawer-right__layout">
            <header class="dads-drawer-right__header">
                <h2 class="dads-drawer-right__title">色覚シミュレーション結果</h2>
                <form method="dialog">
                    <button class="dads-drawer__close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </form>
            </header>
            <div id="a11y-drawer-content" class="dads-drawer-right__body">
                <!-- renderAccessibilityView がここにレンダリング -->
            </div>
        </div>
    </dialog>

    <!-- Color Detail Drawer -->
    <dialog id="color-detail-dialog" class="dads-dialog dads-dialog--drawer">
        <div class="dads-drawer__layout">
            <!-- Mini Scale (Fixed at top edge) -->
            <div id="detail-mini-scale" class="dads-mini-scale">
                <!-- Mini swatches will be populated here -->
            </div>

            <!-- Header Info (Fixed below scale) -->
            <div class="dads-dialog__header">
                <div class="dads-drawer__header-content">
                    <div id="detail-swatch" class="dads-drawer__swatch"></div>
                    <div class="dads-drawer__info">
                        <div class="dads-drawer__name-container">
                            <h2 id="detail-chroma-name" class="dads-drawer__chroma-name"></h2>
                            <button id="detail-name-edit-btn" type="button" class="dads-drawer__edit-btn" aria-label="パレット名を編集" title="パレット名を編集">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>
                            <input id="detail-name-input" type="text" class="dads-drawer__name-input" aria-label="パレット名">
                        </div>
                        <div id="detail-token-name" class="dads-drawer__token-name"></div>
                        <div class="dads-drawer__meta">
                            <code id="detail-hex" class="dads-text-mono"></code>
                            <span id="detail-lightness" class="dads-drawer__lightness"></span>
                        </div>
                    </div>
                    <div class="dads-drawer__close">
                         <form method="dialog">
                            <button class="dads-drawer__close-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Apply Section (Manual view only) -->
            <div id="apply-section" class="dads-drawer__apply-section" style="display: none;">
                <label for="apply-target-select" class="dads-label">適用先:</label>
                <select id="apply-target-select" class="dads-select">
                    <option value="">-- 選択してください --</option>
                    <option value="key">キーカラー</option>
                    <option value="secondary">セカンダリー</option>
                    <option value="tertiary">ターシャリー</option>
                    <optgroup label="アクセント">
                        <option value="accent-1">アクセント 1</option>
                        <option value="accent-2">アクセント 2</option>
                        <option value="accent-3">アクセント 3</option>
                        <option value="accent-4">アクセント 4</option>
                    </optgroup>
                </select>
                <button id="apply-btn" type="button" class="dads-button" data-size="sm" data-type="solid-fill">適用</button>
            </div>

            <!-- Main Content (Scrollable) -->
            <div class="dads-dialog__body">
                <div class="dads-drawer__grid">
                    <!-- Col 1: Contrast -->
                    <div class="dads-drawer__contrast-col">
                        <h3 class="dads-drawer__section-title">コントラスト</h3>
                        <div class="dads-grid" data-columns="2">
                            <!-- Light Background Card -->
                            <div id="detail-white-card" class="dads-contrast-card" data-bg="white">
                                <div class="dads-contrast-card__header">
                                    <span id="detail-white-label" class="dads-contrast-card__label">ライト背景に対するコントラスト</span>
                                    <span id="detail-white-badge" class="dads-badge">-</span>
                                </div>
                                <div class="dads-contrast-card__value">
                                    <span id="detail-white-ratio" class="dads-contrast-card__ratio">-</span>
                                    <span class="dads-contrast-card__unit">:1</span>
                                </div>
                                <div id="detail-white-preview" class="dads-contrast-card__preview">
                                    吾輩は猫である。名前はまだ無い。どこで生れたかとんと見当がつかぬ。
                                </div>
                                <div id="detail-white-preview-large" class="dads-contrast-card__preview--large">
                                    大きな文字での見え方を確認します
                                </div>
                                <div id="detail-white-fail-icon" class="dads-contrast-card__fail">
                                    ⚠️ コントラスト不足
                                </div>
                            </div>

                            <!-- Dark Background Card -->
                            <div id="detail-black-card" class="dads-contrast-card" data-bg="black">
                                <div class="dads-contrast-card__header">
                                    <span id="detail-black-label" class="dads-contrast-card__label">ダーク背景に対するコントラスト</span>
                                    <span id="detail-black-badge" class="dads-badge">-</span>
                                </div>
                                <div class="dads-contrast-card__value">
                                    <span id="detail-black-ratio" class="dads-contrast-card__ratio">-</span>
                                    <span class="dads-contrast-card__unit">:1</span>
                                </div>
                                <div id="detail-black-preview" class="dads-contrast-card__preview">
                                    吾輩は猫である。名前はまだ無い。どこで生れたかとんと見当がつかぬ。
                                </div>
                                <div id="detail-black-preview-large" class="dads-contrast-card__preview--large">
                                    大きな文字での見え方を確認します
                                </div>
                                <div id="detail-black-fail-icon" class="dads-contrast-card__fail">
                                    ⚠️ コントラスト不足
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Col 2: Color Tuner & Actions -->
                    <div class="dads-drawer__tuner-col">
                         <h3 class="dads-drawer__section-title">カラーチューナー</h3>
                         <p class="dads-drawer__tuner-help">
                            ドラッグ: ↔ 色相 (Hue)<br>
                            Shift + ドラッグ: 精密操作
                         </p>
                         <!-- Infinite Scrubber -->
                        <div class="dads-scrubber">
                             <canvas id="tuner-scrubber"></canvas>
                             <!-- Center Indicator -->
                             <div class="dads-scrubber__indicator"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </dialog>

    <script type="module" src="./dist/index.js"></script>
</body>

</html>
